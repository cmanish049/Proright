<?php

/**
 * Description of ajax
 *
 * @author Alexander
 */
class Ajax_search extends Admin_Controller
{
    public function __construct()
    {
        parent::__construct();

        $this->config->set_item('compress_output', FALSE);
    }

    private function _get_json_for_autocomplete($array = array(), $value_field = '', $text_field = '')
    {
        $json = array();
        foreach($array as $index => $a)
        {
            if(is_object($a))
            {
                $json[] = array('id' => $a->{$value_field}, 'value' => $a->{$text_field}, 'label' => $a->{$text_field});
            }
            else
            {
                $json[] = array('id' => $a[$value_field], 'value' => $a[$text_field], 'label' => $a[$text_field]);
            }
        }

        return $this->fastjson->encode($json);
    }

    private function _get_options_string_from_array($rows, $value_field, $text_field)
    {        
        $output = '';
        foreach($rows as $e)
        {
            $output .= '<option value="' . $e->{$value_field} . '">' . $e->{$text_field} . '</option>';
        }
        
        return $output;
    }

    function cities()
    {
        $this->load->model('city_model');
        $json['rows'] = $this->city_model->get_rows(
                array(
                    'country_id' => $this->input->get('id'),
                    'select' => 'city_id, city_name',
                    'order_by' => 'city_name',
                    'order' => 'ASC'
                )
        );
        //array_unshift($json, array('value' => '', 'text' => ''));

        $json['html'] = $this->_get_options_string_from_array($json['rows'], 'city_id', 'city_name');
        $this->output->_display($this->fastjson->encode($json));
        //$this->output->_display($this->_get_json_for_autocomplete($json['rows'], 'value', 'text'));
    }

}

